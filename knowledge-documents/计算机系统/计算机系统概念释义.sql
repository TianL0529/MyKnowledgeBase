--计算机基本结构：中央处理器（CPU）、内存、输入设备、输出设备、总线。
-CPU包含：控制单元、寄存器、逻辑运算单元
-常见的寄存器种类：
通用寄存器：用来存放需要进行运算的数据，比如需要进行加和运算的两个数据；
程序计数器：用来存储CPU要执行下一条指令 所在的内存地址 注意不是存储了下一条要执行的指令，此时指令还在内存中，程序计数器只是存储了下一条指令的地址
指令寄存器：用来存放程序计数器指向的指令，也就是指令本身，指令被执行完成之前，指令都存储在这里。
-常见的总线种类：
地址总线：用于指定CPU将要操作的内存地址
数据总线：用于读写内存的数据
控制总线：用于发送和接收信号，比如中断、设备复位等信号，CPU收到信号后自然进行响应，这时也需要控制总线
数据通过线路传输方式：通过操作电压，低电压表示0，高电压表示1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
内存数据段：数据存放区域
内存正文段：指令存放区域
指令的编码：编译器在并编译程序的时候，构造指令的过程
指令的解码：CPU执行程序的时候，解析指令的过程
--指令周期
Fetch（取得指令）：CPU通过程序计数器读取内存地址的指令 --从内存取指令（通过程序计数器和指令寄存器和总线）到控制器
Decode（指令译码）：CPU对指令进行解码 --控制器将指令解析成不同的操作信号以及地址和操作数
Execution（执行指令）：CPU执行指令  --算术逻辑单元根据输入信号和数据进行运算
Store（数据回写）：CPU将计算结果存回寄存器或者将寄存器的值存入内存  --写回内存
--指令的类型
数据传输类型的指令：比如 store/load 是寄存器与内存间数据传输的指令， mov 是将一个内存地址的数据移动到另一个内存地址的指令；
运算类型的指令：比如加减乘除、位运算、比较大小等等，它们最多只能处理两个寄存器中的数据；
跳转类型的指令：通过修改程序计数器的值来达到跳转执行指令的过程，比如编程中常见的 if-else 、 swtich-case 、函数调用等。
信号类型的指令：比如发⽣中断的指令 trap ；
闲置类型的指令：比如指令 nop ，执行后 CPU 会空转一个周期；

时钟周期（2GHZ主频CPU的一个时钟周期是0.5ns）：CPU 的硬件参数都会有 GHz 这个参数，比如一个 1 GHz 的 CPU，指的是时钟频率是 1 G，代表着 1 秒会产生1G 次数的脉冲信号，每一次脉冲信号高低电平的转换就是一个周期
寄存器的数量通常在几十到几百之间，32位CPU中大多数寄存器可以存储 4 个字节；64位CPU中大多数寄存器可以存储 4 个字节
CPU Cache：CPU高速缓存，又分为 L1 Cache、L2 Cache、L3 Cache。--SRAM芯片（Static Random-Access Memory，静态随机存储器），该种芯片一旦断电，数据就会丢失
	L1 Cache：速度在2~4个时钟周期，大小在即使KB到几百KB不等，分为 指令缓存和数据缓存 --1ns
	L2 Cache：速度在10~20个时钟周期，大小在几百KB到几MB不等 --4ns
	L3 Cache：速度在20~60个时钟周期，大小在几MB到几十MB不等
内存：DRAM芯片（Dynamic Random AccessMemory，动态随机存取存储器），速度在200~300个时钟周期之间 --100ns
硬盘：SSD（Solid-state disk），内存的读写速度比 SSD 大概快10~1000 倍 --150us
机械硬盘：Hard Disk Drive, HDD，内存的读写速度比 HDD 大概快10W倍 --10ms

Cache Line（缓存块）：CPU Cache 的数据是从内存中读取过来的，它是以一小块一小块读取数据的，而不是按照单个数组元素来读取数据的，在 CPU Cache 中的，这样一小块一小块的数据，称为 Cache Line（缓存块）。
	CPU Line 是 CPU 从内存读取数据到 Cache的单位
字（Word）：CPU 在从 CPU Cache 读取数据的时候，并不是读取 CPU Line 中的整个数据块，而是读取 CPU 所需要的一个数据片段，这样的数据统称为一个字（Word）。
内存访问地址：包括组标记、CPU Line索引、偏移量
CPU Cache里的数据结构：索引+有效位+组标记+数据块

--通过内存地址找到CPU Cache中的数据的策略：
直接映射Cache（Direct Mapped Cache）
全相联Cache（Fully Associative Cache）
组相连Cache（Set Associative Cache）

--如何写出跑的更快的代码？
1.提升数据缓存的命中率 --顺序访问
2.提升指令缓存的命中率  --分支预测，先排序，再遍历
3.提升多核CPU的缓存命中率  --尽可能让一个进程在同一个核心上执行，例如将线程绑定到某个CPU核心

--CPU缓存一致性
写直达（Write Through）：把数据同时写入内存和Cache中
写回（Write Back）：当发生写操作时，新的数据仅仅被写入Cache Block里，只有当修改过的Cache Block被替换时才需要写入到内存中
脏（Dirty）：标记CPU Cache里面的这个Cache Block的数据和内存是不一致的。
写传播（Wreite Propagation）：某个CPU核心里的Cache数据更新时，必须要传播到其他核心的Cache  --总线嗅探（Bus Snooping）：CPU需要每时每刻监听总线上的一切活动
事务的串行化（Transaction Serialization）：某个CPU核心里对数据的操作顺序，必须在其他核心看起来顺序是一样的 --MESI 协议
--MESI 协议
Modified，已修改
Exclusive，独占
Shared，共享
Invalidated，已失效
Cache伪共享（False Sharing）：因为多个线程同时读写一个Cache Line的不同变量时，而导致CPU Cache失效的现象称为 伪共享
解决伪共享方案：1.宏定义 2.字节填充 + 继承
中断：中断是系统用来相应硬件设备请求的一种机制，操作系统收到硬件的中断请求，会打断正在执行的进程，然后调用内核中的中断处理程序来响应请求。
上半部分：用来处理中断，一般会暂时关闭中断请求，主要负责处理跟硬件紧密相关或者时间敏感的事情 --硬中断
下半部分：用来延迟处理上半部分未完成的工作，一般以内核线程的方式运行 --软中断

浮点数储存方式：符号位 + 指数位 + 尾数
内核：计算机是由各种外部硬件设备组成的，比如内存、cpu、硬盘等，如果每个应用都要和这些硬件设别对接通信协议，那这样太累了，
所以这个 中间人就由内核来负责，让内核作为应用连接硬件设备的桥梁，应用程序只需要关心和内核交互，不用关心硬件的细节
--内核的功能：
1.管理进程、线程，决定哪个进程、线程使用CPU，也就是进程调度的能力
2.管理内存，决定内存的分配和回收，也就是内存管理的能力
3.管理硬件设备，为进程与硬件设备之间提供通信能力，也就是硬件通信能力
4.提供系统调用，如果应用程序要运行更高权限的服务，那么就需要有系统调用，它是用户程序与操作系统之间的接口
--内存分为两个区域：
内核空间：只有内核程序可以访问；
用户空间：这个内存空间专门给应用程序使用；
用户空间的代码只能访问一个局部的内存空间，而内核空间的代码可以访问所有内存空间。
MMU（Memory Management Unit）：内存管理单元
--内存分段（Segmentation）：段选择子（短号+特权等标志位）+段内偏移量
缺点：1.内存碎片问题（内部内存碎片、外部内存碎片【~解决方案：内存交换】） ；2.内存交换的效率低问题；
--内存分页（Paging）：分也是把整个虚拟和物理内存空间切成一段段固定尺寸的大小，这样一个连续并且尺寸固定的内存空间称为页（Page）
	页号+页内偏移
缺点：复杂的地址转换到来了时间上的开销，执行多访问的储存空间也局限于某个内存区域。
-把最常访问的几个页表存储到访问速度更快的硬件，于是计算机科学家们就在CPU芯片中，加入了一个专门存放程序最常访问的页表项的Cache，
这个Cache就是TLB（Translation Lookaside Buffer），通常称为页表缓存、转址旁路缓存、块表等。TLB的命中率是很高的，因为程序最常访问的页就那么几个。
换出（Swap Out）：如果内存不够，操作系统会把其他正在运行的进程中的最近没有被使用的内存页面给释放掉，也就是暂时写在硬盘上
换入（Swap In）：当需要的时候，再加载进来
多级页表（Multi-Level Page Table）：解决内存分页页表占用内存过大的问题 --局部性原理：
	如果某个以及页表的页表项没有被用到，也就不需要创建这个页表项对应的二级页表了，即可以在需要时才创建二级页表。
	比如：假设只有20%的以及页项被用到了，那么页表占用的内存空间就只有4KB（一级页表） + 20%*4MB（二级页表） = 0.804MB，这对比单机页表的4MB就是一个巨大的节约
对于64位的系统，两级分页更定不够了，就变成了司机目录，分别是：
全局目录项PGD（Page Global Directory）；
上层页目录项PUD（Page Upper Directory）；
中间页目录项PMD（Page Middle Directory）；
页表项PTE（Page Table Entry）；
--段页式内存管理：内存分段和内存分页联合起来，先分段再分页，结构由 短号+段内页+页内位移。增加了硬件成本和系统开销，单提高了内存的利用率
1.第一次访问段表，得到页表起始地址
2.第二次访问页表，得到物理页表
3.第三次将物理页号与页内位移组合，得到物理地址
--逻辑地址和线性地址（虚拟地址）：
程序所使用的地址，通常是没被短时内存管理映射的地址，称为逻辑地址
通过段式内存管理映射的地址，称为线性地址，也叫虚拟地址。
-逻辑地址是段式内存管理转换前的地址，线性地址则是页式内存管理转换前的地址。 --针对软件就讲逻辑地址，针对cpu就讲线性地址，针对硬件就讲物理地址。

--进程和线程 --线程是调度的基本单位，进程是操作系统分配资源的基本单位
进程（Process）：我们编写的代码只是一个存储在硬盘的静态文件，通过编译后就会生成二进制可执行文件，当我们运行这个可执行文件后，它会
被装载到内存中，接着CPU会执行程序中的每一条指令，那么这个运行中的程序就被称为进程
~进程的状态：
运行状态（Runing）:该时刻进程占用CPU
就绪状态（Ready）：可运行，由于其他进程处于运行状态而暂时停止运行
阻塞状态（Blocked）：该进程正在等待某一事件发生（如等待输入/输出操作的完成）而暂时停止运行，这时，及时给他CPU控制权，它也无法运行
创建状态（new）：进程正在被创建时的状态
结束状态（Exit）：进程正在从系统中消失时的状态
阻塞挂起状态：进程在外存（硬盘）并等待某个事件的出现；
就绪挂起状态：进程在外存（硬盘），但只要进入内存，即可立即运行；
~进程控制块（process control block，PCB）：来描述进程的数据结构，进程存在的唯一标识，具体包含的信息：
进程描述信息（进程标识符+用户标识符）、进程控制和管理信息（进程当前状态+进程优先级）、资源分配清单、CPU相关信息
~上下文切换
进程的上下文切换：各个进程之间是共享CPU资源的，在不同的时候进程之间需要切换，让不同的进程可以在CPU执行，那么这个 一个进程切换到另一个进程运行，称为进程的上下文切换
CPU上下文：CPU 寄存器和程序计数是 CPU 在运行任何任务前，所必须依赖的环境，这些环境就叫做 CPU上下文 
CPU上下文切换可分成：进程上下文切换、线程上下文切换和中断上下文切换
~线程( Thread )：线程之间可以并发运行且共享相同的地址空间。线程是进程中的一条执行流程
	同⼀个进程内多个线程之间可以共享代码段、数据段、打开的文件等资源，但每个线程各有都有一套独自的寄存器和栈，这样可以确保线程的控制流是相对独立的。
~线程的优缺点：
优点：
1.一个进程中可以同时同时存在多个线程；
2.各个线程之间可以并发执行；
3.各个线程之间可以共享地址空间和文件等资源
缺点：当进程中的一个线程崩溃时，会导致其所属进程的所有线程崩溃
~线程的上下文切换
线程控制块（Thread Control Block, TCB）：对于操作系统而言看不到TCB，只能看到整个进程的PCB
~用户线程的优点：
1.每个进程都需要有它私有的线程控制块（TCB）列表，用来跟踪记录它各个线程状态信息（PC、栈指针、寄存器），
TCB由用户级线程库函数来维护，可用于不支持线程技术的操作系统；
2.用户线程的切换也是由线程库函数来完成的，无需用户态与内核态的切换，所以速度特别快；
~用户线程的缺点：
1.由于操作系统不参与线程的调度，如果一个线程发起了系统调用而阻塞，那进程所包含的用户线程都本能够执行了；
2.当一个线程开始运行后，除非它主动地交出CPU的使用权，否则他所在的进程当中的其他线程无法运行，因为用户态的
线程没法打断当前运行中的线程，他没有这个特权，只有操作系统才有，但是用户线程不是由操作系统管理的；
3.由于时间片分配个进程，故与其他进程比，在多线程执行时，每个线程的得到的时间片较少，执行会比较慢；
~内核线程：内核线程是由操作系统管理的，线程对应的TCB自然是放在操作系统里的，这样线程的创建、终止和管理都是由操作系统负责。
~内核线程的优点：
1.在一个进程当中，如果某个内核线程发起系统调用而被阻塞，并不会影响其他内核线程的运行；
2.分配给线程，多线程的进程获得更多的CPU运行时间。
~内核线程的缺点：
1.在支持内核线程的操作系统中，由内核来维护进程和线程的上下文信息，如PCB和TCB，现成的创建、终止和切换都是通过系统调用的方式进行，因此对于系统来说，系统开销比较大。
~轻量级线程（Light-weight process，LWP）：是内核支持的用户线程，一个进程可有一个或多个LWP，每个LWP是跟内核线程一对一映射的，也就是LWP都是由一个内核线程支持。

--调度
~调度程序（scheduler）：操作系统选择一个进程运行
非抢占式调度算法：挑选一个进程，然后让该进程运行直到被阻塞，或者直到该进程退出，才会调用另外一个进程，也就是不会理时钟中断这个事情。
~抢占式调度算法：挑选一个进程，然后让该进程只运行某段时间，如果在该时段结束时，该进程仍然在运行时，则会把她挂起，接着调度程序从就绪队列挑选另外一个
进程。这种抢占式调度处理，需要在时间间隔的末端发生时钟中断，以便把CPU控制返回给调度程序进行调度，也就是常说的时间片机制。
~调度的原则：提高CPU利用率、提高系统的吞吐量、减小进程的周转时间、减少就绪队列中进程的等待时间、提高交互式比较强的应用的响应时间
~调度算法
先来先服务（First Come First Seved, FCFS）调度算法
最短作业优先（Shortest Job First, SJF）调度算法
高响应比优先（Highest Response Ratio Next, HRRN）调度算法 --权衡了短作业和长作业。优先权 = （等待时间+要求服务时间）/要求服务时间）/要
时间片轮转（Round Robin, RR）调度算法 --时间片值一般设为 20ms~50ms
最高优先级（Highest Priority First，HPF）调度算法
多级反馈队列（Multilevel Feedback Queue）调度算法 --时间片轮转算法 和 最高优先级算法 的综合和发展。
	设置了多个队列，赋予每个队列不同的优先级，每个队列优先级从高到低，同时优先级越高时间片越短；
	新的进程会被放入到第一级队列的末尾，按先来先服务的原则排队等待被调度，如果在第一级队列规定的时间没运行完成，则将其转入到第二级队列的末尾，以此类推，直至完成；
	当较高优先级的队列为空，才调度较低优先级的队列中的进程运行。如果进程运行时，有新进程进入较高优先级的队列，则停止当前运行的进程并将其移入到原队列末尾，接着让较高优先级的进程运行；

--进程间通信
管道队列  -管道就是内核里面的一串缓存，通信方式是单向的、低效的，不适合进程间频繁的交换数据 --保存在内核内存中的缓存
消息队列  -消息队列是保存在内核中的消息链表，消息不及时，有大小限制，不适合比较大数据传输，消息队列通信过程中，存在用户态与内核态之间的数据拷贝开销 --保存在内核中的消息链表
共享内存  -拿出一块虚拟地址空间来，映射到相同的物理内存中，同时修改一个共享内存可能引起冲突
信号量    -保护机制，是一个整型的计数器，主要用于实现进程间的互斥与同步，而不是用于缓存进程间通信的数据，PV操作
信号      -信号量 方式的进程间通信，是常规状态下的工作模式；异常情况下的工作模式，需要 信号 的方式来通知进程，信号是进程间通信机制中唯一的异步通信机制
Socket    -管道、消息队列、共享内存、信号量和信号都是在同一台主机上进行进程间通信；Socket通信可以跨网络与不同主机上的进程之间通信（同主机也可以通信）

临界区：可能导致竞争状态的多线程执行操作共享变量的代码段，它是访问共享资源的代码片段，一定不能给多线程同时执行。
同步：就是并发进程/线程在一些关键点上可能需要互相等待与互通消息，这种互相制约的等待与互通信息被称为进程/线程同步。
实现进程/线程间正确的协作方法：锁（加锁、解锁操作）、信号量（P、V操作）。其中信号量比锁的功能更强一些，信号量还可以发方便地实现进程/线程同步。
--锁
根据锁的实现不同，可以分为 忙等待锁（或自旋锁spin lock） 和 无忙等待锁
--信号量
原子性：同时成功，同时失败
PV操作的函数是由操作系统管理和实现的，所以操作系统已经使得执行PV函数时是具有原子性的
--死锁
~死锁发生的条件：互斥条件、持有并等待条件、不可剥夺条件、环路等待条件
~避免死锁：破坏其中一个条件就可以，最常见的并且可行的是使用资源有序分配法，来破坏环路等待条件，即不同线程总是以相同的顺序申请自己想要的资源
--互斥锁和自旋锁 --各种锁的地基
互斥锁加锁失败后，线程会释放CPU，给其他线程，是一种独占锁；加锁失败会从用户态陷入到内核态，让内核帮我们切换线程，虽然简化了使用锁的难度，但是存在一定的性能开销成本
自旋锁加锁失败后，线程会忙等待，知道它拿到锁；通过CPu函数，在用户态完成加锁和解锁操作，不会主动产生线程上下文切换，所以相比互斥锁来说，会快一些，开销也小一些。
	当加锁失败时，互斥锁用线程切换来应对，自旋锁则用忙等待来应对
--读优先锁和写优先锁 --可以基于互斥锁也可以基于自旋锁
读优先锁：读锁能被更多的线程持有，读线程A获取读锁，写线程B阻塞，写线程给C获取读锁，A和C读完，B获取写锁
写优先锁：优先服务写线程：读线程A获取读锁，写线程B阻塞，写线程给C阻塞，A读完，B获取写锁，B写完，B获取读锁
公平读写锁：读优先锁和写优先锁都可能会出现线程 饥饿 现象。公平读写锁比较简单的一种方式是：用队列把获取锁的线程排队，不管是写线程还是读线程都是按照先进先出的原则加锁，这样读线程仍然可以并发，也不会出现 饥饿 的现象，
--乐观锁与悲观锁
悲观锁：悲观锁做事比较悲观，他认为多线程同时修改共享资源的概率比较高，于是很容易出现冲突，所以访问共享资源前，先要加上锁
	互斥锁、自旋锁、读写锁都是属于悲观锁。
乐观锁：乐观锁做事比较乐观，它假定冲突的概率很低，工作方式：先修改完共享资源，再验证这段时间内有没有发生冲突，
	如果没有其他线程在修改资源，那么操作完成，如果发现有其他线程已经修改过这个资源，就放弃本次操作。 --在线文档、SVN、Git
	乐观锁虽然去除了加锁解锁的操作，但是一旦发生冲突，重试的成本非常高，所以只有在冲突概率非常低，且解锁成本非常高的场景时，才考虑使用乐观锁。

--调度算法：进程调度算法、页面置换算法、磁盘调度算法
~缺页中断：当CPU访问的页面不在物理内存时，便会产生一个缺页终端，请求操作系统将所缺页调入到物理内存。
页表项：页号 + 物理页号 + 状态位 + 访问字段 + 修改位 + 硬盘地址
状态位：用于表示该页是否有效，也就是说是否在物理内存中，供程序访问时参考。
访问字段：用于记录该页在一段时间被访问的次数，共页面置换算法选择出页面时参考。
修改位：表示该页在调入内存后是否有被修改过，由于内存中的每一页都在磁盘上保留一份副本，因此，如果没有修改，在置换该页时就不需要将该页写回到磁盘上，以减少系统的开销；如果已经被修改，则该页重新写到磁盘上，以保证磁盘中所保留的始终是最新的副本。
磁盘地址：用于指出该页在硬盘上的地址，通常是物理块号，供调入该页时使用。
~页面置换算法：当出现缺页异常，需要调入新页面而内存已满时，选择被置换的物理页面也就是说选择一个物理页面换出到磁盘，然乎把需要访问的页面换入到物理页。
~算法分为：
最佳页面置换算法（OPT）：置换在未来最长时间不访问的页面
先进先出置换算法（FIFO）：选择在内存驻留时间很长的页面进行置换
最近最久未使用的置换算法（LRU）：发生缺页时，选择最长时间没有被访问的页面进行置换
时钟页面置换算法（Lock）：把所有的页面都保存在一个类似钟面的环形链表中，一个表针执行最老的页面。当发生缺页中断时，算法首先检查表针指向的页面：
	如果它的访问位位是 0 就淘汰该页面，并把新的页面插入这个位置，然后把表针前移一个位置；
	如果访问位是 1 就清除访问位，并把表针前移一个位置，重复这个过程直到找到了一个访问位为 0 的页面为止；
最不常用置换算法（LFU）：选择访问次数最少的哪个页面，并将其淘汰。
~磁盘调度算法：98，183，37，122，14，124，65，67，当前磁道的位置位53 
先来先服务算法：98，183，37，122，14，124，65，67
最短寻道时间优选算法：65，67，37，14，98，122，124，183
扫描算法算法（电梯算法）：37，14， 0 ，65，67，98，122，124，183
循环扫描算法：65，67，98，122，124，183， 199（终点） ， 0（起点） ，14，37
LOOK与C-LOOK算法：53，65，67，98，122，124，183，0（起点），14，37

--文件系统
索引节点：就是 inode，用记录文件的元信息，如 inode 编号、文件大小、访问权限、创建时间、修改时间、数据在磁盘的位置等等。索引节点是文件的唯一标识，它们之间一一对应，也同样都会被存储在硬盘中，所以索引节点同样占⽤磁盘空间。
目录项：就是dentry，用来记录文件的名字、索引节点指针以及与其他项目录项的层级关联关系。多个目录相关联起来，就会形成目录结构，但它与索引节点不同的是，目录项是由内核维护的一个数据结构，不存放于磁盘，而是缓存在内存。

--I/O模型
缓冲非缓冲I/O：文件操作的标准库是可以实现数据的缓存，那么根据「是否利用标准库缓冲」，可以把文件 I/O 分为缓冲I/O 和非缓冲 I/O：
	缓冲 I/O，利用的是标准库的缓存实现文件的加速访问，而标准库再通过系统调用访问文件。
	非缓冲 I/O，直接通过系统调用访问文件，不经过标准库缓存。
直接I/O和非直接I/O：根据是否利用操作系统的缓存，可以把文件I/O 分为直接I/O 与非直接I/O：
	直接I/O，不会发生内核缓存和用户程序之间数据复制，而是直接经过文件系统访问磁盘；
	非直接I/O，读操作时，数据从内核缓存中拷贝给用户程序，写操作时，数据从用户程序拷贝给内核缓存，再由内核决定什么时候写入数据到磁盘。
阻塞I/O：当用户程序执行read，线程会被阻塞，一直等到内核数据准备好，并把数据从内核缓冲区拷贝到应用程序的缓冲区中，当拷贝过程完成，rea才会返回。
	阻塞等待的是「内核数据准备好」和「数据从内核态拷贝到用户态」这两个过程
非阻塞I/O：非阻塞的read请求在数据未准备好的情况下立即返回，可以继续往下执行，此时应用程序不断轮询内核，直到数据准备好，内核将数据拷贝到应用程序缓冲区，rea调用才可以获取到结果。
基于非阻塞I/O多路复用（select/poll/epoll）：
	无论是阻塞I/O、非阻塞 I/O，还是基于非阻塞 I/O 的多路复用都是同步调用。因为它们在 read调用时，内核将数据从内核空间拷贝到应用程序空间，过程都是需要等待的，也就是说这个过程是同步的，
	如果内核实现的拷贝效率不高，read 调用就会在这个同步过程中等待比较长的时间。
异步I/O：「内核数据准备好」和「数据从内核态拷贝到用户态」这两个过程都不用等待。

DMA（Direct Memory Access）：直接内存访问技术。在进行I/O设备和内存的数据传输的时候，数据搬运的工作全部交给DMA控制器，而CPU不再参与任何与数据搬运相关的事情，这样CPU就可以去处理别的事务。
PageCache（PageCache）：磁盘⾼速缓存。文件传输过程，其中第一步都是先需要先把磁盘文件数据拷贝「内核缓冲区」里，这个「内核缓冲区」实际上是磁盘高速缓存。
	PageCache 来缓存最近被访问的数据，针对大文件的传输不应该使用PageCache。
--大文件传输实现方式：在高并发的场景下，针对大文件的传输的方式，应该使用「异步 I/O + 直接 I/O」来替代零拷贝技术
异步I/O会绕开PageCache，绕开PageCache的I/O叫直接I/O，使用PageCache的I/O叫缓存I/O。通常，对于磁盘，异步I/O支支持直接I/O。

--高性能⽹络模式：Reactor 和 Proactor
Reactor：Reactor 模式也叫 Dispatcher 模式，即 I/O 多路复用监听事件，收到事件后，根据事件类型分配（Dispatch）给某个进程 / 线程。






























